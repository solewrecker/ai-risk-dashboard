<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tool Risk Assessment System</title>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #fafafa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #666;
        }

        .control-group {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-group label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }

        select, input, button {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #666;
            box-shadow: 0 0 0 2px rgba(102, 102, 102, 0.15);
        }

        button {
            background: #666;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #555;
            transform: translateY(-1px);
        }

        .add-tool-btn {
            background: #4a9a4a;
        }

        .add-tool-btn:hover {
            background: #3d8b3d;
        }

        .export-btn {
            background: #333;
        }

        .export-btn:hover {
            background: #222;
        }

        .risk-legend {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .risk-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .critical { background: #d32f2f; color: white; }
        .high { background: #ff9800; color: white; }
        .medium { background: #ffc107; color: #2c3e50; }
        .low { background: #388e3c; color: white; }

        .compliance-badges {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .compliance-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .compliance-hipaa { background: #e3f2fd; color: #1565c0; border: 1px solid #90caf9; }
        .compliance-gdpr { background: #f3e5f5; color: #7b1fa2; border: 1px solid #ce93d8; }
        .compliance-sox { background: #fff3e0; color: #ef6c00; border: 1px solid #ffcc02; }
        .compliance-pci { background: #e8f5e8; color: #2e7d32; border: 1px solid #81c784; }
        
        .non-compliant { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }
        .compliant { background: #e8f5e8; color: #2e7d32; border: 1px solid #81c784; }
        .partial-compliant { background: #fff8e1; color: #f57c00; border: 1px solid #ffb74d; }

        .tools-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .tool-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 6px solid transparent;
            position: relative;
        }

        .tool-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .tool-card.critical { border-left-color: #d32f2f; }
        .tool-card.high { border-left-color: #ff9800; }
        .tool-card.medium { border-left-color: #ffc107; }
        .tool-card.low { border-left-color: #388e3c; }

        .tool-header {
            padding: 20px 25px 15px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .tool-info {
            flex: 1;
        }

        .tool-name {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .tool-score {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .score-number {
            font-size: 2em;
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 8px;
            color: white;
            min-width: 60px;
            text-align: center;
        }

        .score-critical { background: #d32f2f; }
        .score-high { background: #ff9800; }
        .score-medium { background: #ffc107; color: #2c3e50; }
        .score-low { background: #388e3c; }

        .tool-body {
            padding: 20px 25px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .score-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid #666;
        }

        .score-category {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
            margin-bottom: 4px;
        }

        .score-value {
            font-size: 1.1em;
            color: #7f8c8d;
        }

        .details-toggle {
            background: none;
            border: 1px solid #bdc3c7;
            color: #2c3e50;
            padding: 6px 12px;
            font-size: 12px;
            margin-top: 10px;
        }

        .details-toggle:hover {
            background: #ecf0f1;
            transform: none;
        }

        .tool-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ecf0f1;
        }

        .tool-details.show {
            display: block;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-section h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .detail-section ul {
            list-style: none;
            padding-left: 15px;
        }

        .detail-section li {
            margin-bottom: 4px;
            font-size: 0.9em;
            color: #5d6d7e;
            position: relative;
        }

        .detail-section li:before {
            content: "‚Ä¢";
            color: #666;
            position: absolute;
            left: -15px;
        }

        .sub-scores {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 10px 0;
        }

        .sub-score-item {
            background: #f0f0f0;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #555;
            border-left: 3px solid #999;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

        .sub-score-label {
            font-weight: 600;
            min-width: 80px;
        }

        .sub-score-details {
            flex: 1;
            font-style: italic;
            color: #666;
        }

        .edit-sub-score {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 12px;
            padding: 2px 4px;
        }

        .edit-sub-score:hover {
            color: #333;
        }

        .tool-selection {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 10;
        }

        .tool-selection input[type="checkbox"] {
            transform: scale(1.2);
            cursor: pointer;
        }

        .select-all-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .export-format-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .add-tool-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #388e3c;
            display: none;
        }

        .add-tool-form.show {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .export-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .export-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .export-content h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .filter-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .filter-section h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @media (max-width: 768px) {
            .score-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .score-breakdown {
                grid-template-columns: 1fr;
            }
            
            .tool-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tool-score {
                margin-top: 15px;
                justify-content: flex-start;
            }
        }

        .score-editor {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .score-editor-category {
            border-bottom: 1px solid #e0e0e0;
        }
        .score-editor-category:last-child {
            border-bottom: none;
        }

        .score-editor-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            text-align: left;
        }
        
        .score-editor-header:hover {
            background: #f1f3f5;
        }

        .score-editor-header h4 {
            margin: 0;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .score-editor-header span {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }
        
        .score-editor-content {
            padding: 20px;
            display: none;
        }
        
        .score-editor-content.show {
            display: block;
        }
        
        .sub-score-group {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .sub-score-group label {
            font-weight: 600;
        }
        
        .sub-score-inputs {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI Tool Risk Assessment System</h1>
            <p>Comprehensive risk evaluation and management for AI tools in enterprise environments</p>
            <div style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
                <span id="saveStatus">‚úÖ Data automatically saved to browser storage</span>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Filter by Risk:</label>
                <select id="riskFilter">
                    <option value="all">All Risk Levels</option>
                    <option value="critical">Critical Risk (80-100)</option>
                    <option value="high">High Risk (60-79)</option>
                    <option value="medium">Medium Risk (35-59)</option>
                    <option value="low">Low Risk (0-34)</option>
                </select>

                <label>Filter by Category:</label>
                <select id="categoryFilter">
                    <option value="all">All Categories</option>
                    <option value="Public AI Platform">Public AI Platform</option>
                    <option value="Enterprise AI Platform">Enterprise AI Platform</option>
                    <option value="Enterprise Productivity AI">Enterprise Productivity AI</option>
                    <option value="Self-hosted Open Source">Self-hosted Open Source</option>
                </select>

                <label>Search Tools:</label>
                <input type="text" id="searchInput" placeholder="Search by tool name...">
            </div>

            <div class="control-group">
                <button onclick="toggleAddForm()" class="add-tool-btn">Add New Tool</button>
                <button onclick="showImportModal()" style="background: #3498db;">üìÇ Import Tools</button>
                <button onclick="showExportModal()" class="export-btn">Export Report</button>
                <button onclick="resetToDefaults()" style="background: #ff6b6b;">Reset to Defaults</button>
                <label>Total Tools: <span id="toolCount">0</span></label>
            </div>
        </div>

        <div class="risk-legend">
            <div class="risk-badge critical">üî¥ Critical Risk (80-100)</div>
            <div class="risk-badge high">üü† High Risk (60-79)</div>
            <div class="risk-badge medium">üü° Medium Risk (35-59)</div>
            <div class="risk-badge low">üü¢ Low Risk (0-34)</div>
        </div>

        <div class="add-tool-form" id="addToolForm">
            <h3>Add/Edit AI Tool Assessment</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="toolName">Tool Name</label>
                    <input type="text" id="toolName" placeholder="e.g., ChatGPT Enterprise">
                </div>
                <div class="form-group">
                    <label for="toolCategory">Category</label>
                    <select id="toolCategory">
                        <option value="Public AI Platform">Public AI Platform</option>
                        <option value="Enterprise AI Platform">Enterprise AI Platform</option>
                        <option value="Enterprise Productivity AI">Enterprise Productivity AI</option>
                        <option value="Developer Tool">Developer Tool</option>
                        <option value="Self-hosted Open Source">Self-hosted Open Source</option>
                        <option value="Custom">Custom</option>
                    </select>
                </div>
            </div>

            <div class="score-editor">
                <!-- Data Storage & Security -->
                <div class="score-editor-category">
                    <button type="button" class="score-editor-header" onclick="toggleScoreEditorCategory(this)">
                        <h4>Data Storage & Security</h4>
                        <span id="form_dataStorage_total">0/25</span>
                    </button>
                    <div class="score-editor-content">
                        <div class="form-group sub-score-group">
                            <label for="form_dataStorage_geographic_score">Geographic</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_dataStorage_geographic_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_dataStorage_geographic_note" class="sub-score-note" placeholder="Note for Geographic...">
                            </div>
                        </div>
                        <div class="form-group sub-score-group">
                            <label for="form_dataStorage_encryption_score">Encryption</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_dataStorage_encryption_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_dataStorage_encryption_note" class="sub-score-note" placeholder="Note for Encryption...">
                            </div>
                        </div>
                        <div class="form-group sub-score-group">
                            <label for="form_dataStorage_retention_score">Retention</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_dataStorage_retention_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_dataStorage_retention_note" class="sub-score-note" placeholder="Note for Retention...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Training Data Usage -->
                <div class="score-editor-category">
                    <button type="button" class="score-editor-header" onclick="toggleScoreEditorCategory(this)">
                        <h4>Training Data Usage</h4>
                        <span id="form_trainingUsage_total">0/25</span>
                    </button>
                    <div class="score-editor-content">
                        <div class="form-group sub-score-group">
                            <label for="form_trainingUsage_training_score">Training</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_trainingUsage_training_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_trainingUsage_training_note" class="sub-score-note" placeholder="Note for Training...">
                            </div>
                        </div>
                        <div class="form-group sub-score-group">
                            <label for="form_trainingUsage_sharing_score">Sharing</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_trainingUsage_sharing_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_trainingUsage_sharing_note" class="sub-score-note" placeholder="Note for Sharing...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Access Controls -->
                <div class="score-editor-category">
                    <button type="button" class="score-editor-header" onclick="toggleScoreEditorCategory(this)">
                        <h4>Access Controls</h4>
                        <span id="form_accessControls_total">0/20</span>
                    </button>
                    <div class="score-editor-content">
                        <div class="form-group sub-score-group">
                            <label for="form_accessControls_admin_score">Admin</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_accessControls_admin_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_accessControls_admin_note" class="sub-score-note" placeholder="Note for Admin...">
                            </div>
                        </div>
                        <div class="form-group sub-score-group">
                            <label for="form_accessControls_audit_score">Audit</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_accessControls_audit_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_accessControls_audit_note" class="sub-score-note" placeholder="Note for Audit...">
                            </div>
                        </div>
                        <div class="form-group sub-score-group">
                            <label for="form_accessControls_integration_score">Integration</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_accessControls_integration_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_accessControls_integration_note" class="sub-score-note" placeholder="Note for Integration...">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance & Legal Risk -->
                <div class="score-editor-category">
                    <button type="button" class="score-editor-header" onclick="toggleScoreEditorCategory(this)">
                        <h4>Compliance & Legal Risk</h4>
                        <span id="form_complianceRisk_total">0/20</span>
                    </button>
                    <div class="score-editor-content">
                        <div class="form-group sub-score-group">
                            <label for="form_complianceRisk_violations_score">Violations</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_complianceRisk_violations_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_complianceRisk_violations_note" class="sub-score-note" placeholder="Note for Violations...">
                            </div>
                        </div>
                        <div class="form-group sub-score-group">
                            <label for="form_complianceRisk_transparency_score">Transparency</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_complianceRisk_transparency_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_complianceRisk_transparency_note" class="sub-score-note" placeholder="Note for Transparency...">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vendor Transparency -->
                <div class="score-editor-category">
                    <button type="button" class="score-editor-header" onclick="toggleScoreEditorCategory(this)">
                        <h4>Vendor Transparency</h4>
                        <span id="form_vendorTransparency_total">0/10</span>
                    </button>
                    <div class="score-editor-content">
                        <div class="form-group sub-score-group">
                            <label for="form_vendorTransparency_score_score">Overall Score</label>
                            <div class="sub-score-inputs">
                                <input type="number" id="form_vendorTransparency_score_score" class="sub-score-input" oninput="updateFormTotals()" placeholder="Score">
                                <input type="text" id="form_vendorTransparency_score_note" class="sub-score-note" placeholder="Note for Vendor Transparency...">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="toolRecommendation">Executive Summary Recommendation (Optional)</label>
                <textarea id="toolRecommendation" placeholder="Enter a custom recommendation for exported reports. If left blank, a default will be generated based on the risk score." style="min-height: 80px;"></textarea>
            </div>

            <h4>Compliance Status</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label for="hipaaCompliance">HIPAA Compliance</label>
                    <select id="hipaaCompliance">
                        <option value="compliant">‚úÖ Compliant</option>
                        <option value="partial-compliant">‚ö†Ô∏è Partial Compliance</option>
                        <option value="non-compliant" selected>‚ùå Non-Compliant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="gdprCompliance">GDPR Compliance</label>
                    <select id="gdprCompliance">
                        <option value="compliant">‚úÖ Compliant</option>
                        <option value="partial-compliant">‚ö†Ô∏è Partial Compliance</option>
                        <option value="non-compliant" selected>‚ùå Non-Compliant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="soxCompliance">SOX Compliance</label>
                    <select id="soxCompliance">
                        <option value="compliant">‚úÖ Compliant</option>
                        <option value="partial-compliant">‚ö†Ô∏è Partial Compliance</option>
                        <option value="non-compliant" selected>‚ùå Non-Compliant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pciCompliance">PCI-DSS Compliance</label>
                    <select id="pciCompliance">
                        <option value="compliant">‚úÖ Compliant</option>
                        <option value="partial-compliant">‚ö†Ô∏è Partial Compliance</option>
                        <option value="non-compliant" selected>‚ùå Non-Compliant</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="addTool()">Save Tool</button>
                <button onclick="toggleAddForm()" style="background: #95a5a6;">Cancel</button>
            </div>
        </div>

        <div class="select-all-controls">
            <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                <label><strong>Select Tools for Export:</strong></label>
                <button onclick="selectAllTools()" style="background: #666; padding: 6px 12px; font-size: 12px;">Select All</button>
                <button onclick="deselectAllTools()" style="background: #999; padding: 6px 12px; font-size: 12px;">Deselect All</button>
                <button onclick="selectByRisk('critical')" style="background: #d32f2f; padding: 6px 12px; font-size: 12px;">Select Critical</button>
                <button onclick="selectByRisk('high')" style="background: #ff9800; padding: 6px 12px; font-size: 12px;">Select High</button>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span style="font-size: 0.9em; color: #666;">üìä Sorted by Risk (Highest ‚Üí Lowest)</span>
                <span id="selectedCount" style="font-weight: 600;">0 tools selected</span>
            </div>
        </div>

        <div class="tools-grid" id="toolsGrid">
            <!-- Tools will be populated here -->
        </div>
    </div>

    <!-- Export Modal -->
    <div class="export-modal" id="exportModal">
        <div class="export-content">
            <h3>Export Risk Assessment Report</h3>
            
            <div class="export-format-section">
                <h4>Export Format:</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="radio" name="exportFormat" id="exportHTML" value="html" checked>
                        <label for="exportHTML">HTML Report</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="exportFormat" id="exportPDF" value="pdf">
                        <label for="exportPDF">üìÑ PDF Report</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="exportFormat" id="exportJSON" value="json">
                        <label for="exportJSON">JSON Data</label>
                    </div>
                </div>
            </div>

            <div class="filter-section" id="htmlOptions">
                <h4>Selection Method:</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="radio" name="selectionMethod" id="useSelected" value="selected" checked>
                        <label for="useSelected">Use Selected Tools (<span id="modalSelectedCount">0</span> selected)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="selectionMethod" id="useRiskLevels" value="risk">
                        <label for="useRiskLevels">Filter by Risk Levels</label>
                    </div>
                </div>
            </div>

            <div class="filter-section" id="riskLevelOptions" style="display: none;">
                <h4>Risk Levels to Include:</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportCritical" checked>
                        <label for="exportCritical">Critical</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportHigh" checked>
                        <label for="exportHigh">High</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportMedium" checked>
                        <label for="exportMedium">Medium</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="exportLow" checked>
                        <label for="exportLow">Low</label>
                    </div>
                </div>
            </div>

            <div class="filter-section" id="detailLevelOptions">
                <h4>Detail Level:</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="radio" name="detailLevel" id="basicReport" value="basic" checked>
                        <label for="basicReport">üìä Executive Summary</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="detailLevel" id="proReport" value="pro">
                        <label for="proReport">üìã Full Technical Report</label>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="exportReport()">Generate Report</button>
                <button onclick="closeExportModal()" style="background: #95a5a6;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="export-modal" id="importModal">
        <div class="export-content" style="max-width: 700px;">
            <h3>üìÇ Import AI Tool Assessments</h3>
            
            <div class="export-format-section">
                <h4>Import Format:</h4>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="radio" name="importFormat" id="importJSON" value="json" checked onchange="toggleImportOptions()">
                        <label for="importJSON">üìÑ JSON File</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="importFormat" id="importCSV" value="csv" onchange="toggleImportOptions()">
                        <label for="importCSV">üìä CSV/Excel File</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="importFormat" id="importFramework" value="framework" onchange="toggleImportOptions()">
                        <label for="importFramework">üìã Framework Format</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="importFormat" id="importTemplate" value="template" onchange="toggleImportOptions()">
                        <label for="importTemplate">üìù Use Template</label>
                    </div>
                </div>
            </div>

            <div class="filter-section" id="fileUploadSection">
                <h4>Select File:</h4>
                <input type="file" id="importFileInput" accept=".json,.csv,.xlsx,.txt" style="margin-bottom: 10px; width: 100%; padding: 10px; border: 2px dashed #ccc; border-radius: 6px;">
                <div style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                    <strong>Supported formats:</strong> JSON, CSV, Excel, or text files with AI tool data
                </div>
            </div>

            <div class="filter-section" id="importTemplateSection" style="display: none;">
                <h4>Download Import Template:</h4>
                <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                    <p style="margin-bottom: 10px; font-size: 0.9em;">Get a template file to format your existing tools:</p>
                    <button onclick="downloadImportTemplate('csv')" style="margin-right: 10px; background: #27ae60; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;">üìä Download CSV Template</button>
                    <button onclick="downloadImportTemplate('json')" style="background: #3498db; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;">üìÑ Download JSON Template</button>
                </div>
            </div>

            <div class="filter-section" id="importOptionsSection">
                <h4>Import Options:</h4>
                <div class="checkbox-group" style="flex-direction: column; align-items: flex-start;">
                    <div class="checkbox-item">
                        <input type="checkbox" id="mergeExisting" checked>
                        <label for="mergeExisting">Merge with existing tools (keep both)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="overwriteExisting">
                        <label for="overwriteExisting">Overwrite existing tools with same name</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="validateImport" checked>
                        <label for="validateImport">Validate data before import</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="autoMapFields" checked>
                        <label for="autoMapFields">Auto-map fields from different formats</label>
                    </div>
                </div>
            </div>

            <div class="filter-section" id="previewSection" style="display: none;">
                <h4>Preview Import Data:</h4>
                <div id="importPreview" style="max-height: 200px; overflow-y: auto; padding: 10px; background: #f8f9fa; border-radius: 6px; font-family: monospace; font-size: 0.8em;"></div>
                <div id="importStats" style="margin-top: 10px; font-size: 0.9em; color: #666;"></div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="processImport()" id="importButton">üìÇ Import Tools</button>
                <button onclick="closeImportModal()" style="background: #95a5a6;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Default sample data from the framework
        const defaultTools = [
            {
                name: "ChatGPT Free",
                dataStorage: 20,
                trainingUsage: 25,
                accessControls: 20,
                complianceRisk: 15,
                vendorTransparency: 2,
                category: "Public AI Platform",
                lastUpdated: "2024-01-15",
                compliance: {
                    hipaa: "non-compliant",
                    gdpr: "partial-compliant",
                    sox: "non-compliant",
                    pci: "non-compliant"
                },
                subScores: {
                    dataStorage: { 
                        geographic: { score: 6, note: "servers in multiple countries with unclear data residency requirements" },
                        encryption: { score: 4, note: "basic TLS in transit, limited information on encryption at rest" },
                        retention: { score: 10, note: "indefinite retention of training data with no user control over deletion" }
                    },
                    trainingUsage: { 
                        training: { score: 20, note: "all user conversations are used for training future models unless explicitly opted out" },
                        sharing: { score: 5, note: "data may be shared with contractors and service providers with limited transparency" }
                    },
                    accessControls: { 
                        admin: { score: 8, note: "no enterprise-level user management, limited ability to control access at organizational level" },
                        audit: { score: 7, note: "minimal logging and audit trails for enterprise oversight" },
                        integration: { score: 5, note: "basic OAuth integration only, limited SSO capabilities" }
                    },
                    complianceRisk: { 
                        violations: { score: 15, note: "not HIPAA compliant for healthcare data, high GDPR risk due to training data usage" },
                        transparency: { score: 0, note: "reasonably clear privacy policies and terms of service" }
                    },
                    vendorTransparency: { 
                        score: { score: 2, note: "significant gaps between stated policies and actual implementation practices" }
                    }
                },
                recommendation: "Due to high-risk data practices including use of conversations for model training and lack of enterprise controls, this tool is not approved for any use cases involving sensitive company or customer data."
            },
            {
                name: "Claude Enterprise",
                dataStorage: 5,
                trainingUsage: 0,
                accessControls: 8,
                complianceRisk: 9,
                vendorTransparency: 0,
                category: "Enterprise AI Platform",
                lastUpdated: "2024-01-10",
                compliance: {
                    hipaa: "non-compliant",
                    gdpr: "compliant",
                    sox: "compliant",
                    pci: "partial-compliant"
                },
                subScores: {
                    dataStorage: { 
                        geographic: { score: 0, note: "servers located in US with clear data residency controls and compliance certifications" },
                        encryption: { score: 2, note: "AES-256 encryption at rest and in transit with enterprise key management" },
                        retention: { score: 3, note: "configurable retention periods with user control over data deletion" }
                    },
                    trainingUsage: { 
                        training: { score: 0, note: "contractual guarantee that customer data is never used for training AI models" },
                        sharing: { score: 0, note: "complete tenant isolation with no data sharing with third parties" }
                    },
                    accessControls: { 
                        admin: { score: 0, note: "comprehensive enterprise user management with role-based access controls" },
                        audit: { score: 3, note: "detailed audit logs and compliance reporting capabilities" },
                        integration: { score: 5, note: "limited SSO integration options, primarily SAML-based" }
                    },
                    complianceRisk: { 
                        violations: { score: 9, note: "no HIPAA Business Associate Agreement available for standard enterprise plans" },
                        transparency: { score: 0, note: "excellent documentation with clear security and privacy certifications" }
                    },
                    vendorTransparency: { 
                        score: { score: 0, note: "comprehensive enterprise documentation including security certifications" }
                    }
                },
                recommendation: ""
            },
            {
                name: "Microsoft Copilot M365",
                dataStorage: 5,
                trainingUsage: 0,
                accessControls: 2,
                complianceRisk: 8,
                vendorTransparency: 0,
                category: "Enterprise Productivity AI",
                lastUpdated: "2024-01-08",
                compliance: {
                    hipaa: "partial-compliant",
                    gdpr: "compliant",
                    sox: "compliant",
                    pci: "compliant"
                },
                subScores: {
                    dataStorage: { 
                        geographic: { score: 0, note: "data stored within Microsoft 365 tenant boundaries with full geographic control" },
                        encryption: { score: 2, note: "AES-256 encryption with Microsoft's enterprise key management system" },
                        retention: { score: 3, note: "follows existing Microsoft 365 retention and deletion policies with full administrative control" }
                    },
                    trainingUsage: { 
                        training: { score: 0, note: "contractual guarantee that organizational data is not used for training foundation models" },
                        sharing: { score: 0, note: "complete tenant isolation within Microsoft 365 ecosystem" }
                    },
                    accessControls: { 
                        admin: { score: 0, note: "full integration with Microsoft 365 admin center and existing organizational controls" },
                        audit: { score: 0, note: "comprehensive logging through Microsoft Purview and compliance center" },
                        integration: { score: 2, note: "native Microsoft 365 integration with existing authentication systems" }
                    },
                    complianceRisk: { 
                        violations: { score: 8, note: "web search functionality excluded from HIPAA compliance scope, requiring careful configuration for healthcare environments" },
                        transparency: { score: 0, note: "comprehensive Microsoft enterprise documentation and compliance certifications" }
                    },
                    vendorTransparency: { 
                        score: { score: 0, note: "excellent Microsoft enterprise documentation with comprehensive compliance certifications" }
                    }
                },
                recommendation: "Approved for general productivity, but web search functionality must be disabled for any teams handling regulated or sensitive data due to lack of HIPAA coverage."
            },
            {
                name: "Self-hosted Ollama",
                dataStorage: 0,
                trainingUsage: 0,
                accessControls: 5,
                complianceRisk: 0,
                vendorTransparency: 3,
                category: "Self-hosted Open Source",
                lastUpdated: "2024-01-12",
                compliance: {
                    hipaa: "compliant",
                    gdpr: "compliant",
                    sox: "compliant",
                    pci: "compliant"
                },
                subScores: {
                    dataStorage: { 
                        geographic: { score: 0, note: "complete local control over data storage location and geographic boundaries" },
                        encryption: { score: 0, note: "local implementation control with ability to implement enterprise-grade encryption" },
                        retention: { score: 0, note: "full local control over data retention and deletion policies" }
                    },
                    trainingUsage: { 
                        training: { score: 0, note: "no external training as all processing occurs locally on self-managed infrastructure" },
                        sharing: { score: 0, note: "completely local deployment with no external data transmission" }
                    },
                    accessControls: { 
                        admin: { score: 3, note: "security depends on local implementation and IT administration capabilities" },
                        audit: { score: 2, note: "logging capabilities depend on local configuration and monitoring setup" },
                        integration: { score: 0, note: "full local control over authentication and integration with existing enterprise systems" }
                    },
                    complianceRisk: { 
                        violations: { score: 0, note: "no external data flow eliminates most regulatory compliance risks" },
                        transparency: { score: 0, note: "local deployment eliminates third-party policy dependencies" }
                    },
                    vendorTransparency: { 
                        score: { score: 3, note: "open source software with community-driven documentation, requires internal expertise" }
                    }
                },
                recommendation: "Approved for all use cases, provided that the hosting infrastructure is managed by IT and meets all internal security and compliance standards."
            }
        ];

        // Load tools from localStorage or use default data
        function loadTools() {
            const savedTools = localStorage.getItem('aiRiskAssessmentTools');
            if (savedTools) {
                try {
                    return JSON.parse(savedTools);
                } catch (e) {
                    console.error('Error loading saved tools:', e);
                    return [...defaultTools];
                }
            }
            return [...defaultTools];
        }

        // Save tools to localStorage
        function saveTools() {
            try {
                localStorage.setItem('aiRiskAssessmentTools', JSON.stringify(tools));
                console.log('Tools saved successfully');
                
                // Show save confirmation
                const saveStatus = document.getElementById('saveStatus');
                if (saveStatus) {
                    saveStatus.textContent = '‚úÖ Data saved successfully';
                    setTimeout(() => {
                        saveStatus.textContent = '‚úÖ Data automatically saved to browser storage';
                    }, 2000);
                }
            } catch (e) {
                console.error('Error saving tools:', e);
                const saveStatus = document.getElementById('saveStatus');
                if (saveStatus) {
                    saveStatus.textContent = '‚ùå Error saving data';
                    saveStatus.style.color = '#d32f2f';
                }
                alert('Error saving data. Please check if you have enough storage space.');
            }
        }

        // Initialize tools array
        let tools = loadTools();

        // Tool selection functions
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.tool-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = `${count} tools selected`;
            const modalCount = document.getElementById('modalSelectedCount');
            if (modalCount) modalCount.textContent = count;
        }

        function selectAllTools() {
            document.querySelectorAll('.tool-checkbox').forEach(cb => cb.checked = true);
            updateSelectedCount();
        }

        function deselectAllTools() {
            document.querySelectorAll('.tool-checkbox').forEach(cb => cb.checked = false);
            updateSelectedCount();
        }

        function selectByRisk(riskLevel) {
            document.querySelectorAll('.tool-checkbox').forEach(cb => {
                const index = parseInt(cb.dataset.index);
                const tool = tools[index];
                const totalScore = calculateTotalScore(tool);
                const toolRiskLevel = getRiskLevel(totalScore);
                cb.checked = (toolRiskLevel === riskLevel);
            });
            updateSelectedCount();
        }

        function calculateTotalScore(tool) {
            return tool.dataStorage + tool.trainingUsage + tool.accessControls + tool.complianceRisk + tool.vendorTransparency;
        }

        function getRiskLevel(score) {
            if (score >= 80) return 'critical';
            if (score >= 60) return 'high';
            if (score >= 35) return 'medium';
            return 'low';
        }

        function getRiskEmoji(level) {
            const emojis = { critical: 'üî¥', high: 'üü†', medium: 'üü°', low: 'üü¢' };
            return emojis[level];
        }

        function sortToolsByRisk(toolsArray) {
            return [...toolsArray].sort((a, b) => {
                const scoreA = calculateTotalScore(a);
                const scoreB = calculateTotalScore(b);
                return scoreB - scoreA; // Sort descending (highest risk first)
            });
        }

        function renderTools(toolsToRender = tools) {
            const grid = document.getElementById('toolsGrid');
            grid.innerHTML = '';

            // Always sort tools by risk score (highest to lowest)
            const sortedTools = sortToolsByRisk(toolsToRender);

            sortedTools.forEach((tool, index) => {
                // Find the original index in the main tools array for editing/deleting
                const originalIndex = tools.indexOf(tool);
                const totalScore = calculateTotalScore(tool);
                const riskLevel = getRiskLevel(totalScore);
                
                const toolCard = document.createElement('div');
                toolCard.className = `tool-card ${riskLevel}`;
                toolCard.innerHTML = `
                    <div class="tool-selection">
                        <input type="checkbox" id="tool-${originalIndex}" class="tool-checkbox" data-index="${originalIndex}">
                    </div>
                    <div class="tool-header">
                                                <div class="tool-info">
                        <div class="tool-name">${tool.name}</div>
                            <div style="font-size: 0.9em; color: #666; margin: 5px 0;">
                                <strong>Category:</strong> ${tool.category} | <strong>Last Updated:</strong> ${tool.lastUpdated}
                            </div>
                            ${tool.compliance ? `
                                <div class="compliance-badges">
                                    ${tool.compliance.hipaa ? `<div class="compliance-badge ${tool.compliance.hipaa === 'compliant' ? 'compliant' : tool.compliance.hipaa === 'partial-compliant' ? 'partial-compliant' : 'non-compliant'}">
                                        ${tool.compliance.hipaa === 'compliant' ? '‚úÖ HIPAA' : tool.compliance.hipaa === 'partial-compliant' ? '‚ö†Ô∏è HIPAA*' : '‚ùå HIPAA'}
                                    </div>` : ''}
                                    ${tool.compliance.gdpr ? `<div class="compliance-badge ${tool.compliance.gdpr === 'compliant' ? 'compliant' : tool.compliance.gdpr === 'partial-compliant' ? 'partial-compliant' : 'non-compliant'}">
                                        ${tool.compliance.gdpr === 'compliant' ? '‚úÖ GDPR' : tool.compliance.gdpr === 'partial-compliant' ? '‚ö†Ô∏è GDPR*' : '‚ùå GDPR'}
                                    </div>` : ''}
                                    ${tool.compliance.sox ? `<div class="compliance-badge ${tool.compliance.sox === 'compliant' ? 'compliant' : tool.compliance.sox === 'partial-compliant' ? 'partial-compliant' : 'non-compliant'}">
                                        ${tool.compliance.sox === 'compliant' ? '‚úÖ SOX' : tool.compliance.sox === 'partial-compliant' ? '‚ö†Ô∏è SOX*' : '‚ùå SOX'}
                                    </div>` : ''}
                                    ${tool.compliance.pci ? `<div class="compliance-badge ${tool.compliance.pci === 'compliant' ? 'compliant' : tool.compliance.pci === 'partial-compliant' ? 'partial-compliant' : 'non-compliant'}">
                                        ${tool.compliance.pci === 'compliant' ? '‚úÖ PCI-DSS' : tool.compliance.pci === 'partial-compliant' ? '‚ö†Ô∏è PCI-DSS*' : '‚ùå PCI-DSS'}
                                    </div>` : ''}
                                </div>
                            ` : ''}
                        </div>
                        <div class="tool-score">
                            <div class="score-number score-${riskLevel}">${totalScore}</div>
                            <div>
                                <div class="risk-badge ${riskLevel}">${getRiskEmoji(riskLevel)} ${riskLevel.toUpperCase()} RISK</div>
                            </div>
                        </div>
                    </div>
                    <div class="tool-body">
                        <div class="score-breakdown">
                            <div class="score-item">
                                <div class="score-category">Data Storage & Security</div>
                                <div class="score-value">${tool.dataStorage}/25</div>
                            </div>
                            <div class="score-item">
                                <div class="score-category">Training Data Usage</div>
                                <div class="score-value">${tool.trainingUsage}/25</div>
                            </div>
                            <div class="score-item">
                                <div class="score-category">Access Controls</div>
                                <div class="score-value">${tool.accessControls}/20</div>
                            </div>
                            <div class="score-item">
                                <div class="score-category">Compliance & Legal</div>
                                <div class="score-value">${tool.complianceRisk}/20</div>
                            </div>
                            <div class="score-item">
                                <div class="score-category">Vendor Transparency</div>
                                <div class="score-value">${tool.vendorTransparency}/10</div>
                            </div>
                        </div>
                        <button class="details-toggle" onclick="toggleDetails(${originalIndex})">Show Details</button>
                        <div class="tool-details" id="details-${originalIndex}">
                            <div class="detail-section">
                                <h4>Data Storage & Security (${tool.dataStorage}/25)</h4>
                                <div class="sub-scores">
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Geographic: ${tool.subScores.dataStorage.geographic.score}</div>
                                        <div class="sub-score-details">${tool.subScores.dataStorage.geographic.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'dataStorage', 'geographic')">‚úèÔ∏è</button>
                                    </div>
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Encryption: ${tool.subScores.dataStorage.encryption.score}</div>
                                        <div class="sub-score-details">${tool.subScores.dataStorage.encryption.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'dataStorage', 'encryption')">‚úèÔ∏è</button>
                                    </div>
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Retention: ${tool.subScores.dataStorage.retention.score}</div>
                                        <div class="sub-score-details">${tool.subScores.dataStorage.retention.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'dataStorage', 'retention')">‚úèÔ∏è</button>
                                    </div>
                                </div>
                                <p>${tool.details.dataStorage}</p>
                            </div>
                            <div class="detail-section">
                                <h4>Training Data Usage (${tool.trainingUsage}/25)</h4>
                                <div class="sub-scores">
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Training: ${tool.subScores.trainingUsage.training.score}</div>
                                        <div class="sub-score-details">${tool.subScores.trainingUsage.training.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'trainingUsage', 'training')">‚úèÔ∏è</button>
                                    </div>
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Sharing: ${tool.subScores.trainingUsage.sharing.score}</div>
                                        <div class="sub-score-details">${tool.subScores.trainingUsage.sharing.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'trainingUsage', 'sharing')">‚úèÔ∏è</button>
                                    </div>
                                </div>
                                <p>${tool.details.trainingUsage}</p>
                            </div>
                            <div class="detail-section">
                                <h4>Access Controls (${tool.accessControls}/20)</h4>
                                <div class="sub-scores">
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Admin: ${tool.subScores.accessControls.admin.score}</div>
                                        <div class="sub-score-details">${tool.subScores.accessControls.admin.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'accessControls', 'admin')">‚úèÔ∏è</button>
                                    </div>
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Audit: ${tool.subScores.accessControls.audit.score}</div>
                                        <div class="sub-score-details">${tool.subScores.accessControls.audit.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'accessControls', 'audit')">‚úèÔ∏è</button>
                                    </div>
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Integration: ${tool.subScores.accessControls.integration.score}</div>
                                        <div class="sub-score-details">${tool.subScores.accessControls.integration.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'accessControls', 'integration')">‚úèÔ∏è</button>
                                    </div>
                                </div>
                                <p>${tool.details.accessControls}</p>
                            </div>
                            <div class="detail-section">
                                <h4>Compliance & Legal Risk (${tool.complianceRisk}/20)</h4>
                                <div class="sub-scores">
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Violations: ${tool.subScores.complianceRisk.violations.score}</div>
                                        <div class="sub-score-details">${tool.subScores.complianceRisk.violations.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'complianceRisk', 'violations')">‚úèÔ∏è</button>
                                    </div>
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Transparency: ${tool.subScores.complianceRisk.transparency.score}</div>
                                        <div class="sub-score-details">${tool.subScores.complianceRisk.transparency.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'complianceRisk', 'transparency')">‚úèÔ∏è</button>
                                    </div>
                                </div>
                                <p>${tool.details.complianceRisk}</p>
                            </div>
                            <div class="detail-section">
                                <h4>Vendor Transparency (${tool.vendorTransparency}/10)</h4>
                                <div class="sub-scores">
                                    <div class="sub-score-item">
                                        <div class="sub-score-label">Overall Score: ${tool.subScores.vendorTransparency.score.score}</div>
                                        <div class="sub-score-details">${tool.subScores.vendorTransparency.score.note}</div>
                                        <button class="edit-sub-score" onclick="editSubScore(${originalIndex}, 'vendorTransparency', 'score')">‚úèÔ∏è</button>
                                    </div>
                                </div>
                                <p>${tool.details.vendorTransparency}</p>
                            </div>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button onclick="editTool(${originalIndex})" style="background: #666; font-size: 12px; padding: 4px 8px;">Edit Tool</button>
                            <button onclick="deleteTool(${originalIndex})" style="background: #d32f2f; font-size: 12px; padding: 4px 8px;">Delete Tool</button>
                        </div>
                    </div>
                `;
                grid.appendChild(toolCard);
            });

            document.getElementById('toolCount').textContent = sortedTools.length;
            
            // Add event listeners to checkboxes
            document.querySelectorAll('.tool-checkbox').forEach(cb => {
                cb.addEventListener('change', updateSelectedCount);
            });
            
            updateSelectedCount();
        }

        function toggleDetails(index) {
            const details = document.getElementById(`details-${index}`);
            const button = details.previousElementSibling;
            
            if (details.classList.contains('show')) {
                details.classList.remove('show');
                button.textContent = 'Show Details';
            } else {
                details.classList.add('show');
                button.textContent = 'Hide Details';
            }
        }

        function filterTools() {
            const riskFilter = document.getElementById('riskFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = tools.filter(tool => {
                const matchesSearch = tool.name.toLowerCase().includes(searchTerm);
                const totalScore = calculateTotalScore(tool);
                const riskLevel = getRiskLevel(totalScore);
                const matchesRisk = riskFilter === 'all' || riskLevel === riskFilter;
                const matchesCategory = categoryFilter === 'all' || tool.category === categoryFilter;
                
                return matchesSearch && matchesRisk && matchesCategory;
            });
            
            renderTools(filtered);
        }

        function toggleAddForm() {
            const form = document.getElementById('addToolForm');
            
            // Reset editing state if closing form
            if (form.classList.contains('show')) {
                editingIndex = -1;
                document.querySelector('#addToolForm h3').textContent = 'Add New AI Tool Assessment';
                document.querySelector('#addToolForm button[onclick="addTool()"]').textContent = 'Add Tool';
                
                // Clear form
                document.getElementById('addToolForm').querySelectorAll('input, textarea, select').forEach(input => {
                    if (input.type === 'number') input.value = '0';
                    else input.value = '';
                });
                document.getElementById('toolRecommendation').value = '';
                updateFormTotals();
            }
            
            form.classList.toggle('show');
        }

        let editingIndex = -1; // Track which tool is being edited

        function addTool() {
            const name = document.getElementById('toolName').value;
            if (!name) {
                alert('Please enter a tool name');
                return;
            }

            const toolData = {
                name: name,
                category: document.getElementById('toolCategory').value,
                lastUpdated: new Date().toISOString().split('T')[0],
                dataStorage: 0, trainingUsage: 0, accessControls: 0, complianceRisk: 0, vendorTransparency: 0, // Will be calculated
                recommendation: document.getElementById('toolRecommendation').value || "",
                compliance: {
                    hipaa: document.getElementById('hipaaCompliance').value,
                    gdpr: document.getElementById('gdprCompliance').value,
                    sox: document.getElementById('soxCompliance').value,
                    pci: document.getElementById('pciCompliance').value
                },
                subScores: {
                    dataStorage: { 
                        geographic: { score: parseInt(document.getElementById('form_dataStorage_geographic_score').value) || 0, note: document.getElementById('form_dataStorage_geographic_note').value },
                        encryption: { score: parseInt(document.getElementById('form_dataStorage_encryption_score').value) || 0, note: document.getElementById('form_dataStorage_encryption_note').value },
                        retention:  { score: parseInt(document.getElementById('form_dataStorage_retention_score').value) || 0, note: document.getElementById('form_dataStorage_retention_note').value }
                    },
                    trainingUsage: { 
                        training: { score: parseInt(document.getElementById('form_trainingUsage_training_score').value) || 0, note: document.getElementById('form_trainingUsage_training_note').value },
                        sharing:  { score: parseInt(document.getElementById('form_trainingUsage_sharing_score').value) || 0, note: document.getElementById('form_trainingUsage_sharing_note').value }
                    },
                    accessControls: { 
                        admin: { score: parseInt(document.getElementById('form_accessControls_admin_score').value) || 0, note: document.getElementById('form_accessControls_admin_note').value },
                        audit: { score: parseInt(document.getElementById('form_accessControls_audit_score').value) || 0, note: document.getElementById('form_accessControls_audit_note').value },
                        integration: { score: parseInt(document.getElementById('form_accessControls_integration_score').value) || 0, note: document.getElementById('form_accessControls_integration_note').value }
                    },
                    complianceRisk: { 
                        violations:   { score: parseInt(document.getElementById('form_complianceRisk_violations_score').value) || 0, note: document.getElementById('form_complianceRisk_violations_note').value },
                        transparency: { score: parseInt(document.getElementById('form_complianceRisk_transparency_score').value) || 0, note: document.getElementById('form_complianceRisk_transparency_note').value }
                    },
                    vendorTransparency: { 
                        score: { score: parseInt(document.getElementById('form_vendorTransparency_score_score').value) || 0, note: document.getElementById('form_vendorTransparency_score_note').value }
                    }
                },
                details: {} // Will be generated from notes
            };
            
            // Calculate main scores from sub-scores
            toolData.dataStorage = toolData.subScores.dataStorage.geographic.score + toolData.subScores.dataStorage.encryption.score + toolData.subScores.dataStorage.retention.score;
            toolData.trainingUsage = toolData.subScores.trainingUsage.training.score + toolData.subScores.trainingUsage.sharing.score;
            toolData.accessControls = toolData.subScores.accessControls.admin.score + toolData.subScores.accessControls.audit.score + toolData.subScores.accessControls.integration.score;
            toolData.complianceRisk = toolData.subScores.complianceRisk.violations.score + toolData.subScores.complianceRisk.transparency.score;
            toolData.vendorTransparency = toolData.subScores.vendorTransparency.score.score;

            // Generate details from notes
            toolData.details = {
                dataStorage: `Geographic: ${toolData.subScores.dataStorage.geographic.note} | Encryption: ${toolData.subScores.dataStorage.encryption.note} | Retention: ${toolData.subScores.dataStorage.retention.note}`,
                trainingUsage: `Training: ${toolData.subScores.trainingUsage.training.note} | Sharing: ${toolData.subScores.trainingUsage.sharing.note}`,
                accessControls: `Admin: ${toolData.subScores.accessControls.admin.note} | Audit: ${toolData.subScores.accessControls.audit.note} | Integration: ${toolData.subScores.accessControls.integration.note}`,
                complianceRisk: `Violations: ${toolData.subScores.complianceRisk.violations.note} | Transparency: ${toolData.subScores.complianceRisk.transparency.note}`,
                vendorTransparency: `${toolData.subScores.vendorTransparency.score.note}`
            };


            if (editingIndex >= 0) {
                // Update existing tool
                tools[editingIndex] = toolData;
                editingIndex = -1;
                document.querySelector('#addToolForm h3').textContent = 'Add New AI Tool Assessment';
                document.querySelector('#addToolForm button[onclick="addTool()"]').textContent = 'Add Tool';
            } else {
                // Add new tool
                tools.push(toolData);
            }

            // Sort tools after adding/editing to maintain risk order
            tools = sortToolsByRisk(tools);

            saveTools(); // Save to localStorage
            renderTools();
            toggleAddForm();
            
            // Clear form
            document.getElementById('addToolForm').querySelectorAll('input, textarea, select').forEach(input => {
                if (input.type === 'number') input.value = '';
                else if (input.type === 'text') input.value = '';
            });
            updateFormTotals();
        }

        function editTool(index) {
            const tool = tools[index];
            editingIndex = index;
            
            // Populate form with existing data
            document.getElementById('toolName').value = tool.name;
            document.getElementById('toolCategory').value = tool.category;
            document.getElementById('toolRecommendation').value = tool.recommendation || '';

            // Populate sub-scores and notes
            document.getElementById('form_dataStorage_geographic_score').value = tool.subScores.dataStorage.geographic.score;
            document.getElementById('form_dataStorage_geographic_note').value = tool.subScores.dataStorage.geographic.note;
            document.getElementById('form_dataStorage_encryption_score').value = tool.subScores.dataStorage.encryption.score;
            document.getElementById('form_dataStorage_encryption_note').value = tool.subScores.dataStorage.encryption.note;
            document.getElementById('form_dataStorage_retention_score').value = tool.subScores.dataStorage.retention.score;
            document.getElementById('form_dataStorage_retention_note').value = tool.subScores.dataStorage.retention.note;

            document.getElementById('form_trainingUsage_training_score').value = tool.subScores.trainingUsage.training.score;
            document.getElementById('form_trainingUsage_training_note').value = tool.subScores.trainingUsage.training.note;
            document.getElementById('form_trainingUsage_sharing_score').value = tool.subScores.trainingUsage.sharing.score;
            document.getElementById('form_trainingUsage_sharing_note').value = tool.subScores.trainingUsage.sharing.note;

            document.getElementById('form_accessControls_admin_score').value = tool.subScores.accessControls.admin.score;
            document.getElementById('form_accessControls_admin_note').value = tool.subScores.accessControls.admin.note;
            document.getElementById('form_accessControls_audit_score').value = tool.subScores.accessControls.audit.score;
            document.getElementById('form_accessControls_audit_note').value = tool.subScores.accessControls.audit.note;
            document.getElementById('form_accessControls_integration_score').value = tool.subScores.accessControls.integration.score;
            document.getElementById('form_accessControls_integration_note').value = tool.subScores.accessControls.integration.note;

            document.getElementById('form_complianceRisk_violations_score').value = tool.subScores.complianceRisk.violations.score;
            document.getElementById('form_complianceRisk_violations_note').value = tool.subScores.complianceRisk.violations.note;
            document.getElementById('form_complianceRisk_transparency_score').value = tool.subScores.complianceRisk.transparency.score;
            document.getElementById('form_complianceRisk_transparency_note').value = tool.subScores.complianceRisk.transparency.note;

            document.getElementById('form_vendorTransparency_score_score').value = tool.subScores.vendorTransparency.score.score;
            document.getElementById('form_vendorTransparency_score_note').value = tool.subScores.vendorTransparency.score.note;

            updateFormTotals();
            
            // Populate compliance fields
            if (tool.compliance) {
                document.getElementById('hipaaCompliance').value = tool.compliance.hipaa || 'non-compliant';
                document.getElementById('gdprCompliance').value = tool.compliance.gdpr || 'non-compliant';
                document.getElementById('soxCompliance').value = tool.compliance.sox || 'non-compliant';
                document.getElementById('pciCompliance').value = tool.compliance.pci || 'non-compliant';
            }
            
            // Update form title and button
            document.querySelector('#addToolForm h3').textContent = 'Edit AI Tool Assessment';
            document.querySelector('#addToolForm button[onclick="addTool()"]').textContent = 'Update Tool';
            
            // Show the form
            document.getElementById('addToolForm').classList.add('show');
            // Open all sections
            document.querySelectorAll('.score-editor-content').forEach(el => el.classList.add('show'));
        }

        function editSubScore(toolIndex, category, subCategory) {
            // This function is now obsolete and can be removed.
            // All editing is done via the main form.
            alert("Please use the 'Edit Tool' button to modify scores in the main form.");
        }

        function deleteTool(index) {
            if (confirm('Are you sure you want to delete this tool?')) {
                tools.splice(index, 1);
                saveTools(); // Save to localStorage
                renderTools();
            }
        }

        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all data to defaults? This will remove all your custom tools and edits.')) {
                tools = [...defaultTools];
                saveTools(); // Save to localStorage
                renderTools();
                alert('Data has been reset to default values.');
            }
        }

        function generatePDFReport(toolsToExport, detailLevel) {
            // Show loading message
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'pdfLoading';
            loadingDiv.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 30px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 10000; text-align: center; font-family: 'Segoe UI', sans-serif;
            `;
            loadingDiv.innerHTML = `
                <div style="font-size: 1.2em; margin-bottom: 15px;">üìÑ Generating PDF Report...</div>
                <div style="color: #666;">This may take a few seconds</div>
            `;
            document.body.appendChild(loadingDiv);

            // Create temporary container for PDF content
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = `
                position: absolute; left: -9999px; top: 0; width: 210mm; 
                font-family: 'Segoe UI', sans-serif; background: white; padding: 20px;
            `;
            
            const riskStats = {
                critical: toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'critical').length,
                high: toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'high').length,
                medium: toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'medium').length,
                low: toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'low').length
            };

            tempContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 40px; padding: 30px; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; border-radius: 8px;">
                    <h1 style="font-size: 2.2em; margin-bottom: 10px; font-weight: 300;">üîí AI Tool Risk Assessment Report</h1>
                    <div style="font-size: 1.1em; opacity: 0.9; margin-bottom: 15px;">Comprehensive Enterprise Risk Analysis & Compliance Assessment</div>
                    <div style="font-size: 0.9em; opacity: 0.8; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px; margin-top: 15px;">
                        Generated: ${new Date().toLocaleDateString()} | ${toolsToExport.length} tools assessed | ${detailLevel === 'pro' ? 'Full Technical Report' : 'Executive Summary'}
                    </div>
                </div>

                <div style="background: white; padding: 25px; margin-bottom: 30px; border-radius: 8px; border-left: 6px solid #3498db;">
                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.6em;">üìä Executive Summary</h2>
                    <p style="font-size: 1.05em; color: #5d6d7e; margin-bottom: 20px; line-height: 1.6;">
                        This assessment evaluates <strong>${toolsToExport.length} AI tools</strong> across five critical risk categories, 
                        providing actionable insights for enterprise security and compliance decisions.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; border-left: 4px solid #d32f2f;">
                            <div style="font-size: 2em; font-weight: 700; color: #2c3e50;">${riskStats.critical}</div>
                            <div style="font-size: 0.85em; color: #666; text-transform: uppercase;">üî¥ Critical</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; border-left: 4px solid #ff9800;">
                            <div style="font-size: 2em; font-weight: 700; color: #2c3e50;">${riskStats.high}</div>
                            <div style="font-size: 0.85em; color: #666; text-transform: uppercase;">üü† High</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; border-left: 4px solid #ffc107;">
                            <div style="font-size: 2em; font-weight: 700; color: #2c3e50;">${riskStats.medium}</div>
                            <div style="font-size: 0.85em; color: #666; text-transform: uppercase;">üü° Medium</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; border-left: 4px solid #388e3c;">
                            <div style="font-size: 2em; font-weight: 700; color: #2c3e50;">${riskStats.low}</div>
                            <div style="font-size: 0.85em; color: #666; text-transform: uppercase;">üü¢ Low</div>
                        </div>
                    </div>
                </div>

                ${toolsToExport.map(tool => {
                    const totalScore = calculateTotalScore(tool);
                    const riskLevel = getRiskLevel(totalScore);
                    const riskEmoji = getRiskEmoji(riskLevel);
                    const borderColor = riskLevel === 'critical' ? '#d32f2f' : 
                                       riskLevel === 'high' ? '#ff9800' :
                                       riskLevel === 'medium' ? '#ffc107' : '#388e3c';
                    
                    return `
                        <div style="background: white; margin-bottom: 25px; border-radius: 8px; border-left: 6px solid ${borderColor}; overflow: hidden; page-break-inside: avoid;">
                            <div style="background: #f8f9fa; padding: 20px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h3 style="font-size: 1.3em; font-weight: 600; color: #2c3e50; margin-bottom: 5px;">${tool.name}</h3>
                                                                         <div style="font-size: 0.9em; color: #666;">
                                         <strong>Category:</strong> ${tool.category} | <strong>Updated:</strong> ${tool.lastUpdated}
                                     </div>
                                     ${tool.compliance ? `
                                         <div style="margin-top: 8px;">
                                             <div style="font-size: 0.8em; color: #666; margin-bottom: 4px;"><strong>Regulatory Compliance:</strong></div>
                                             <div style="display: flex; gap: 6px; flex-wrap: wrap;">
                                                 ${tool.compliance.hipaa ? `<span style="padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 600; ${tool.compliance.hipaa === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.hipaa === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                     ${tool.compliance.hipaa === 'compliant' ? '‚úÖ HIPAA' : tool.compliance.hipaa === 'partial-compliant' ? '‚ö†Ô∏è HIPAA*' : '‚ùå HIPAA'}
                                                 </span>` : ''}
                                                 ${tool.compliance.gdpr ? `<span style="padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 600; ${tool.compliance.gdpr === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.gdpr === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                     ${tool.compliance.gdpr === 'compliant' ? '‚úÖ GDPR' : tool.compliance.gdpr === 'partial-compliant' ? '‚ö†Ô∏è GDPR*' : '‚ùå GDPR'}
                                                 </span>` : ''}
                                                 ${tool.compliance.sox ? `<span style="padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 600; ${tool.compliance.sox === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.sox === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                     ${tool.compliance.sox === 'compliant' ? '‚úÖ SOX' : tool.compliance.sox === 'partial-compliant' ? '‚ö†Ô∏è SOX*' : '‚ùå SOX'}
                                                 </span>` : ''}
                                                 ${tool.compliance.pci ? `<span style="padding: 2px 6px; border-radius: 6px; font-size: 8px; font-weight: 600; ${tool.compliance.pci === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.pci === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                     ${tool.compliance.pci === 'compliant' ? '‚úÖ PCI-DSS' : tool.compliance.pci === 'partial-compliant' ? '‚ö†Ô∏è PCI-DSS*' : '‚ùå PCI-DSS'}
                                                 </span>` : ''}
                                             </div>
                                         </div>
                                     ` : ''}
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.8em; font-weight: 700; color: white; background: ${borderColor}; padding: 8px 15px; border-radius: 8px; margin-bottom: 5px;">
                                        ${totalScore}/100
                                    </div>
                                    <div style="font-size: 0.8em; font-weight: 600; text-transform: uppercase; color: ${borderColor};">
                                        ${riskEmoji} ${riskLevel}
                                    </div>
                                </div>
                            </div>
                            
                            <div style="padding: 20px;">
                                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px;">
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center; border-left: 3px solid #666;">
                                        <div style="font-size: 1.3em; font-weight: 700; color: #2c3e50;">${tool.dataStorage}</div>
                                        <div style="font-size: 0.7em; color: #999;">/25</div>
                                        <div style="font-size: 0.75em; color: #666; margin-top: 4px;">Data Storage</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center; border-left: 3px solid #666;">
                                        <div style="font-size: 1.3em; font-weight: 700; color: #2c3e50;">${tool.trainingUsage}</div>
                                        <div style="font-size: 0.7em; color: #999;">/25</div>
                                        <div style="font-size: 0.75em; color: #666; margin-top: 4px;">Training Usage</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center; border-left: 3px solid #666;">
                                        <div style="font-size: 1.3em; font-weight: 700; color: #2c3e50;">${tool.accessControls}</div>
                                        <div style="font-size: 0.7em; color: #999;">/20</div>
                                        <div style="font-size: 0.75em; color: #666; margin-top: 4px;">Access Controls</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center; border-left: 3px solid #666;">
                                        <div style="font-size: 1.3em; font-weight: 700; color: #2c3e50;">${tool.complianceRisk}</div>
                                        <div style="font-size: 0.7em; color: #999;">/20</div>
                                        <div style="font-size: 0.75em; color: #666; margin-top: 4px;">Compliance</div>
                                    </div>
                                    <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; text-align: center; border-left: 3px solid #666;">
                                        <div style="font-size: 1.3em; font-weight: 700; color: #2c3e50;">${tool.vendorTransparency}</div>
                                        <div style="font-size: 0.7em; color: #999;">/10</div>
                                        <div style="font-size: 0.75em; color: #666; margin-top: 4px;">Transparency</div>
                                    </div>
                                </div>
                                
                                ${detailLevel === 'pro' ? `
                                    <div style="background: #fdfdfd; padding: 15px; border-top: 1px solid #e9ecef;">
                                        <h4 style="color: #2c3e50; margin-bottom: 15px; font-size: 1.1em;">üîç Detailed Assessment</h4>
                                        
                                                                                 <div style="margin-bottom: 15px;">
                                             <h5 style="color: #2c3e50; font-size: 0.95em; margin-bottom: 8px;">üîê Data Storage & Security</h5>
                                             ${tool.subScores?.dataStorage ? `
                                                 <div style="margin: 8px 0;">
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Geographic:</strong> ${tool.subScores.dataStorage.geographic.note}
                                                     </div>
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Encryption:</strong> ${tool.subScores.dataStorage.encryption.note}
                                                     </div>
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Retention:</strong> ${tool.subScores.dataStorage.retention.note}
                                                     </div>
                                                 </div>
                                             ` : `<p style="font-size: 0.85em; color: #5d6d7e; line-height: 1.5; margin-left: 15px;">${tool.details.dataStorage}</p>`}
                                         </div>
                                         
                                         <div style="margin-bottom: 15px;">
                                             <h5 style="color: #2c3e50; font-size: 0.95em; margin-bottom: 8px;">ü§ñ Training Data Usage</h5>
                                             ${tool.subScores?.trainingUsage ? `
                                                 <div style="margin: 8px 0;">
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Training:</strong> ${tool.subScores.trainingUsage.training.note}
                                                     </div>
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Sharing:</strong> ${tool.subScores.trainingUsage.sharing.note}
                                                     </div>
                                                 </div>
                                             ` : `<p style="font-size: 0.85em; color: #5d6d7e; line-height: 1.5; margin-left: 15px;">${tool.details.trainingUsage}</p>`}
                                         </div>
                                         
                                         <div style="margin-bottom: 15px;">
                                             <h5 style="color: #2c3e50; font-size: 0.95em; margin-bottom: 8px;">üë• Access Controls</h5>
                                             ${tool.subScores?.accessControls ? `
                                                 <div style="margin: 8px 0;">
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Admin:</strong> ${tool.subScores.accessControls.admin.note}
                                                     </div>
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Audit:</strong> ${tool.subScores.accessControls.audit.note}
                                                     </div>
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Integration:</strong> ${tool.subScores.accessControls.integration.note}
                                                     </div>
                                                 </div>
                                             ` : `<p style="font-size: 0.85em; color: #5d6d7e; line-height: 1.5; margin-left: 15px;">${tool.details.accessControls}</p>`}
                                         </div>
                                         
                                         <div style="margin-bottom: 15px;">
                                             <h5 style="color: #2c3e50; font-size: 0.95em; margin-bottom: 8px;">‚öñÔ∏è Compliance & Legal Risk</h5>
                                             ${tool.subScores?.complianceRisk ? `
                                                 <div style="margin: 8px 0;">
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Violations:</strong> ${tool.subScores.complianceRisk.violations.note}
                                                     </div>
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Transparency:</strong> ${tool.subScores.complianceRisk.transparency.note}
                                                     </div>
                                                 </div>
                                             ` : `<p style="font-size: 0.85em; color: #5d6d7e; line-height: 1.5; margin-left: 15px;">${tool.details.complianceRisk}</p>`}
                                         </div>
                                         
                                         <div>
                                             <h5 style="color: #2c3e50; font-size: 0.95em; margin-bottom: 8px;">üîç Vendor Transparency</h5>
                                             ${tool.subScores?.vendorTransparency ? `
                                                 <div style="margin: 8px 0;">
                                                     <div style="background: #f8f9fa; padding: 6px 10px; margin: 3px 0; border-radius: 3px; border-left: 3px solid #999; font-size: 0.8em;">
                                                         <strong>Overall:</strong> ${tool.subScores.vendorTransparency.score.note}
                                                     </div>
                                                 </div>
                                             ` : `<p style="font-size: 0.85em; color: #5d6d7e; line-height: 1.5; margin-left: 15px;">${tool.details.vendorTransparency}</p>`}
                                         </div>
                                    </div>
                                ` : `
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid ${borderColor};">
                                        <p style="font-size: 0.95em; line-height: 1.6; margin-bottom: 10px;">
                                            <strong>${tool.name}</strong> presents <strong style="color: ${borderColor};">${riskLevel} risk</strong> with a total score of <strong>${totalScore}/100</strong>.
                                        </p>
                                        <p style="font-size: 0.9em; color: #666;">
                                            <strong>Recommendation:</strong> 
                                            ${riskLevel === 'critical' ? 'üö® Immediate action required to address critical security concerns.' : 
                                              riskLevel === 'high' ? '‚ö†Ô∏è Significant security improvements needed before deployment.' :
                                              riskLevel === 'medium' ? '‚ö° Moderate risk - implement additional security measures.' : 
                                              '‚úÖ Low risk - suitable for enterprise use with standard precautions.'}
                                        </p>
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                }).join('')}

                <div style="text-align: center; padding: 30px 20px; color: #666; font-size: 0.9em; border-top: 1px solid #e9ecef; margin-top: 30px;">
                    <p style="margin-bottom: 5px;"><strong>AI Tool Risk Assessment Framework</strong></p>
                    <p style="margin-bottom: 5px;">Generated by Enterprise Risk Management System | Confidential & Proprietary</p>
                    <p>For questions about this assessment, please contact your IT Security team</p>
                </div>
            `;

            document.body.appendChild(tempContainer);

            // Generate PDF using jsPDF
            const { jsPDF } = window.jspdf;
            
            html2canvas(tempContainer, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                width: tempContainer.scrollWidth,
                height: tempContainer.scrollHeight
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const imgX = (pdfWidth - imgWidth * ratio) / 2;
                const imgY = 0;

                // Calculate how many pages we need
                const totalHeight = imgHeight * ratio;
                const pageHeight = pdfHeight;
                let heightLeft = totalHeight;
                let position = 0;

                // Add first page
                pdf.addImage(imgData, 'PNG', imgX, imgY - position, imgWidth * ratio, imgHeight * ratio);
                heightLeft -= pageHeight;

                // Add additional pages if needed
                while (heightLeft >= 0) {
                    position += pageHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', imgX, imgY - position, imgWidth * ratio, imgHeight * ratio);
                    heightLeft -= pageHeight;
                }

                // Save the PDF
                const fileName = `AI_Risk_Assessment_Report_${new Date().toISOString().split('T')[0]}.pdf`;
                pdf.save(fileName);

                // Clean up
                document.body.removeChild(tempContainer);
                document.body.removeChild(loadingDiv);
                
                // Show success message
                const successDiv = document.createElement('div');
                successDiv.style.cssText = `
                    position: fixed; top: 20px; right: 20px; background: #388e3c; color: white;
                    padding: 15px 20px; border-radius: 6px; z-index: 10000; font-family: 'Segoe UI', sans-serif;
                `;
                successDiv.innerHTML = '‚úÖ PDF Report Generated Successfully!';
                document.body.appendChild(successDiv);
                setTimeout(() => document.body.removeChild(successDiv), 3000);
                
            }).catch(error => {
                console.error('PDF generation failed:', error);
                document.body.removeChild(tempContainer);
                document.body.removeChild(loadingDiv);
                alert('PDF generation failed. Please try again or use HTML export.');
            });
        }

        function showExportModal() {
            updateSelectedCount(); // Update the count in modal
            document.getElementById('exportModal').classList.add('show');
            
            // Add event listeners for dynamic options
            document.getElementById('exportHTML').addEventListener('change', toggleExportOptions);
            document.getElementById('exportPDF').addEventListener('change', toggleExportOptions);
            document.getElementById('exportJSON').addEventListener('change', toggleExportOptions);
            document.getElementById('useSelected').addEventListener('change', toggleSelectionMethod);
            document.getElementById('useRiskLevels').addEventListener('change', toggleSelectionMethod);
            
            toggleExportOptions(); // Initialize display
        }

        function toggleExportOptions() {
            const isHTML = document.getElementById('exportHTML').checked;
            const isPDF = document.getElementById('exportPDF').checked;
            const showOptions = isHTML || isPDF;
            
            document.getElementById('htmlOptions').style.display = showOptions ? 'block' : 'none';
            document.getElementById('detailLevelOptions').style.display = showOptions ? 'block' : 'none';
            
            if (showOptions) {
                toggleSelectionMethod();
            }
        }

        function toggleSelectionMethod() {
            const useRiskLevels = document.getElementById('useRiskLevels').checked;
            document.getElementById('riskLevelOptions').style.display = useRiskLevels ? 'block' : 'none';
        }

        function closeExportModal() {
            document.getElementById('exportModal').classList.remove('show');
        }

        // Import Modal Functions
        function showImportModal() {
            document.getElementById('importModal').classList.add('show');
            toggleImportOptions(); // Initialize view
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('show');
            // Reset form
            document.getElementById('importFileInput').value = '';
            document.getElementById('previewSection').style.display = 'none';
            document.getElementById('importPreview').innerHTML = '';
        }

        function toggleImportOptions() {
            const format = document.querySelector('input[name="importFormat"]:checked').value;
            const templateSection = document.getElementById('importTemplateSection');
            const fileSection = document.getElementById('fileUploadSection');

            if (format === 'template') {
                templateSection.style.display = 'block';
                fileSection.style.display = 'none';
            } else {
                templateSection.style.display = 'none';
                fileSection.style.display = 'block';
            }

            // Add file change listener
            const fileInput = document.getElementById('importFileInput');
            fileInput.onchange = function(event) {
                if (event.target.files.length > 0) {
                    previewImportFile(event.target.files[0]);
                }
            };
        }

        // Download import templates
        function downloadImportTemplate(format) {
            let templateData, filename, mimeType;

            if (format === 'csv') {
                templateData = generateCSVTemplate();
                filename = 'ai_tools_import_template.csv';
                mimeType = 'text/csv';
            } else if (format === 'json') {
                templateData = generateJSONTemplate();
                filename = 'ai_tools_import_template.json';
                mimeType = 'application/json';
            }

            const blob = new Blob([templateData], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(`üì• Template downloaded! Fill in your tool data and import it back.`);
        }

        // Generate CSV template
        function generateCSVTemplate() {
            const headers = [
                'name', 'category', 'dataStorage', 'trainingUsage', 'accessControls', 
                'complianceRisk', 'vendorTransparency', 'hipaaCompliance', 'gdprCompliance', 
                'soxCompliance', 'pciCompliance', 'lastUpdated', 'notes'
            ];
            
            const sampleRow = [
                'Sample AI Tool', 'Public AI Platform', '15', '20', '12', '10', '3',
                'non-compliant', 'partial-compliant', 'non-compliant', 'non-compliant',
                '2024-01-15', 'Sample tool for demonstration purposes'
            ];

            return headers.join(',') + '\n' + sampleRow.join(',') + '\n';
        }

        // Generate JSON template
        function generateJSONTemplate() {
            const template = {
                metadata: {
                    version: "1.0",
                    importDate: new Date().toISOString(),
                    description: "AI Tool Risk Assessment Import Template"
                },
                tools: [
                    {
                        name: "Sample AI Tool",
                        category: "Public AI Platform",
                        dataStorage: 15,
                        trainingUsage: 20,
                        accessControls: 12,
                        complianceRisk: 10,
                        vendorTransparency: 3,
                        compliance: {
                            hipaa: "non-compliant",
                            gdpr: "partial-compliant",
                            sox: "non-compliant",
                            pci: "non-compliant"
                        },
                        lastUpdated: "2024-01-15",
                        subScores: {
                            dataStorage: {
                                geographic: { score: 5, note: "Example geographic risk note" },
                                encryption: { score: 4, note: "Example encryption risk note" },
                                retention: { score: 6, note: "Example retention risk note" }
                            },
                            trainingUsage: {
                                training: { score: 15, note: "Example training usage note" },
                                sharing: { score: 5, note: "Example data sharing note" }
                            },
                            accessControls: {
                                admin: { score: 4, note: "Example admin controls note" },
                                audit: { score: 4, note: "Example audit capabilities note" },
                                integration: { score: 4, note: "Example integration note" }
                            },
                            complianceRisk: {
                                violations: { score: 8, note: "Example compliance violations note" },
                                transparency: { score: 2, note: "Example transparency note" }
                            },
                            vendorTransparency: {
                                score: { score: 3, note: "Example vendor transparency note" }
                            }
                        },
                        details: {
                            dataStorage: "Detailed explanation of data storage risks",
                            trainingUsage: "Detailed explanation of training data usage",
                            accessControls: "Detailed explanation of access control issues",
                            complianceRisk: "Detailed explanation of compliance risks",
                            vendorTransparency: "Detailed explanation of vendor transparency"
                        }
                    }
                ]
            };
            return JSON.stringify(template, null, 2);
        }

        // Preview import file
        async function previewImportFile(file) {
            const previewSection = document.getElementById('previewSection');
            const previewDiv = document.getElementById('importPreview');
            const statsDiv = document.getElementById('importStats');

            try {
                const content = await readFileContent(file);
                const parsedData = await parseImportData(content, file.name);
                
                if (parsedData && parsedData.tools) {
                    const toolCount = parsedData.tools.length;
                    
                    // Show preview
                    previewDiv.innerHTML = JSON.stringify(parsedData.tools.slice(0, 3), null, 2) + 
                        (toolCount > 3 ? '\n... and ' + (toolCount - 3) + ' more tools' : '');
                    
                    statsDiv.innerHTML = `üìä Found ${toolCount} tools ready for import`;
                    previewSection.style.display = 'block';
                    
                    // Store parsed data for import
                    window.importData = parsedData;
                } else {
                    throw new Error('No valid tools found in file');
                }
            } catch (error) {
                previewDiv.innerHTML = `‚ùå Error: ${error.message}`;
                statsDiv.innerHTML = '';
                previewSection.style.display = 'block';
                window.importData = null;
            }
        }

        // Read file content
        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(new Error('Failed to read file'));
                reader.readAsText(file);
            });
        }

        // Parse import data from various formats
        async function parseImportData(content, filename) {
            const format = document.querySelector('input[name="importFormat"]:checked').value;
            
            try {
                if (filename.endsWith('.json') || format === 'json') {
                    return parseJSONImport(content);
                } else if (filename.endsWith('.csv') || format === 'csv') {
                    return parseCSVImport(content);
                } else if (format === 'framework') {
                    return parseFrameworkImport(content);
                } else {
                    return parseAutoDetect(content);
                }
            } catch (error) {
                throw new Error(`Parse error: ${error.message}`);
            }
        }

        // Parse JSON import
        function parseJSONImport(content) {
            const data = JSON.parse(content);
            
            // Handle various JSON structures
            if (data.tools && Array.isArray(data.tools)) {
                return { tools: data.tools.map(tool => normalizeToolData(tool)) };
            } else if (Array.isArray(data)) {
                return { tools: data.map(tool => normalizeToolData(tool)) };
            } else if (data.name) {
                // Single tool
                return { tools: [normalizeToolData(data)] };
            } else {
                throw new Error('Invalid JSON structure');
            }
        }

        // Parse CSV import
        function parseCSVImport(content) {
            const lines = content.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const tools = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const tool = {};
                
                headers.forEach((header, index) => {
                    tool[header] = values[index] || '';
                });
                
                if (tool.name) {
                    tools.push(normalizeToolData(tool));
                }
            }

            return { tools };
        }

        // Parse framework format (markdown-like)
        function parseFrameworkImport(content) {
            // Parse markdown-style framework format
            const tools = [];
            const sections = content.split(/^#+ /m);
            
            for (const section of sections) {
                if (section.includes('Data Storage') || section.includes('Training Usage')) {
                    const tool = parseFrameworkSection(section);
                    if (tool.name) {
                        tools.push(normalizeToolData(tool));
                    }
                }
            }

            return { tools };
        }

        // Parse framework section
        function parseFrameworkSection(section) {
            const tool = {};
            const lines = section.split('\n');
            
            // Extract tool name from header
            const nameMatch = lines[0].match(/(.+?)(?:\s*\(\d+\/\d+\))?$/);
            if (nameMatch) {
                tool.name = nameMatch[1].trim();
            }

            // Extract scores
            const scoreRegex = /(-\s*\w+:\s*)(\d+)(?:\s*\((.+?)\))?/g;
            let match;
            
            while ((match = scoreRegex.exec(section)) !== null) {
                const category = match[1].replace(/[-\s:]/g, '').toLowerCase();
                const score = parseInt(match[2]);
                const note = match[3] || '';
                
                if (category.includes('geographic') || category.includes('encryption') || category.includes('retention')) {
                    tool.dataStorage = (tool.dataStorage || 0) + score;
                } else if (category.includes('training') || category.includes('sharing')) {
                    tool.trainingUsage = (tool.trainingUsage || 0) + score;
                }
                // Continue for other categories...
            }

            return tool;
        }

        // Auto-detect format
        function parseAutoDetect(content) {
            try {
                return parseJSONImport(content);
            } catch (e) {
                try {
                    return parseCSVImport(content);
                } catch (e) {
                    return parseFrameworkImport(content);
                }
            }
        }

        // Normalize tool data to standard format
        function normalizeToolData(tool) {
            const normalized = {
                name: tool.name || 'Unnamed Tool',
                category: tool.category || 'Other',
                lastUpdated: tool.lastUpdated || new Date().toISOString().split('T')[0],
                dataStorage: parseInt(tool.dataStorage) || 0,
                trainingUsage: parseInt(tool.trainingUsage) || 0,
                accessControls: parseInt(tool.accessControls) || 0,
                complianceRisk: parseInt(tool.complianceRisk) || 0,
                vendorTransparency: parseInt(tool.vendorTransparency) || 0,
                recommendation: tool.recommendation || "",
                compliance: tool.compliance || {
                    hipaa: tool.hipaaCompliance || 'unknown',
                    gdpr: tool.gdprCompliance || 'unknown',
                    sox: tool.soxCompliance || 'unknown',
                    pci: tool.pciCompliance || 'unknown'
                },
                subScores: tool.subScores || generateDefaultSubScores(tool),
                details: tool.details || generateDefaultDetails(tool)
            };

            return normalized;
        }

        // Generate default sub-scores if not provided
        function generateDefaultSubScores(tool) {
            return {
                dataStorage: {
                    geographic: { score: Math.floor(tool.dataStorage * 0.3) || 0, note: "Geographic data storage assessment" },
                    encryption: { score: Math.floor(tool.dataStorage * 0.3) || 0, note: "Encryption standards assessment" },
                    retention: { score: Math.floor(tool.dataStorage * 0.4) || 0, note: "Data retention policy assessment" }
                },
                trainingUsage: {
                    training: { score: Math.floor(tool.trainingUsage * 0.7) || 0, note: "AI training data usage assessment" },
                    sharing: { score: Math.floor(tool.trainingUsage * 0.3) || 0, note: "Third-party data sharing assessment" }
                },
                accessControls: {
                    admin: { score: Math.floor(tool.accessControls * 0.4) || 0, note: "Administrative controls assessment" },
                    audit: { score: Math.floor(tool.accessControls * 0.4) || 0, note: "Audit capabilities assessment" },
                    integration: { score: Math.floor(tool.accessControls * 0.2) || 0, note: "System integration assessment" }
                },
                complianceRisk: {
                    violations: { score: Math.floor(tool.complianceRisk * 0.7) || 0, note: "Regulatory compliance violations" },
                    transparency: { score: Math.floor(tool.complianceRisk * 0.3) || 0, note: "Policy transparency assessment" }
                },
                vendorTransparency: {
                    score: { score: tool.vendorTransparency || 0, note: "Vendor documentation and transparency" }
                }
            };
        }

        // Generate default details if not provided
        function generateDefaultDetails(tool) {
            return {
                dataStorage: tool.notes || "Data storage and security assessment details",
                trainingUsage: tool.notes || "Training data usage assessment details",
                accessControls: tool.notes || "Access controls assessment details",
                complianceRisk: tool.notes || "Compliance risk assessment details",
                vendorTransparency: tool.notes || "Vendor transparency assessment details"
            };
        }

        // Process the import
        function processImport() {
            if (!window.importData || !window.importData.tools) {
                alert('‚ùå No valid data to import. Please select a file first.');
                return;
            }

            const mergeExisting = document.getElementById('mergeExisting').checked;
            const overwriteExisting = document.getElementById('overwriteExisting').checked;
            const validateImport = document.getElementById('validateImport').checked;

            try {
                let importedCount = 0;
                let skippedCount = 0;
                let updatedCount = 0;

                for (const newTool of window.importData.tools) {
                    if (validateImport && !validateToolData(newTool)) {
                        skippedCount++;
                        continue;
                    }

                    const existingIndex = tools.findIndex(t => t.name.toLowerCase() === newTool.name.toLowerCase());
                    
                    if (existingIndex >= 0) {
                        if (overwriteExisting) {
                            tools[existingIndex] = newTool;
                            updatedCount++;
                        } else if (mergeExisting) {
                            // Add with modified name
                            newTool.name += ' (Imported)';
                            tools.push(newTool);
                            importedCount++;
                        } else {
                            skippedCount++;
                        }
                    } else {
                        tools.push(newTool);
                        importedCount++;
                    }
                }

                // Sort tools by risk after import
                tools = sortToolsByRisk(tools);
                
                saveTools(); // Save to localStorage
                renderTools(); // Re-render the dashboard
                closeImportModal();

                // Show success message
                const message = `‚úÖ Import completed!\n\nüìä ${importedCount} tools imported\nüîÑ ${updatedCount} tools updated\n‚è≠Ô∏è ${skippedCount} tools skipped`;
                alert(message);

            } catch (error) {
                alert(`‚ùå Import failed: ${error.message}`);
            }
        }

        // Validate tool data
        function validateToolData(tool) {
            if (!tool.name || tool.name.trim() === '') return false;
            if (tool.dataStorage < 0 || tool.dataStorage > 25) return false;
            if (tool.trainingUsage < 0 || tool.trainingUsage > 25) return false;
            if (tool.accessControls < 0 || tool.accessControls > 20) return false;
            if (tool.complianceRisk < 0 || tool.complianceRisk > 20) return false;
            if (tool.vendorTransparency < 0 || tool.vendorTransparency > 10) return false;
            return true;
        }

        function exportReport() {
            const exportFormat = document.querySelector('input[name="exportFormat"]:checked').value;
            let toolsToExport = [];

            if (exportFormat === 'json') {
                // For JSON, always use selected tools
                const selectedCheckboxes = document.querySelectorAll('.tool-checkbox:checked');
                toolsToExport = Array.from(selectedCheckboxes).map(cb => {
                    const index = parseInt(cb.dataset.index);
                    return tools[index];
                });
                
                if (toolsToExport.length === 0) {
                    alert('Please select at least one tool to export.');
                    return;
                }
                
                exportJSON(toolsToExport);
            } else {
                // HTML or PDF export
                const selectionMethod = document.querySelector('input[name="selectionMethod"]:checked').value;
                
                if (selectionMethod === 'selected') {
                    const selectedCheckboxes = document.querySelectorAll('.tool-checkbox:checked');
                    toolsToExport = Array.from(selectedCheckboxes).map(cb => {
                        const index = parseInt(cb.dataset.index);
                        return tools[index];
                    });
                    
                    if (toolsToExport.length === 0) {
                        alert('Please select at least one tool to export.');
                        return;
                    }
                } else {
                    // Risk level filtering
                    const includeRisks = {
                        critical: document.getElementById('exportCritical').checked,
                        high: document.getElementById('exportHigh').checked,
                        medium: document.getElementById('exportMedium').checked,
                        low: document.getElementById('exportLow').checked
                    };
                    
                    toolsToExport = tools.filter(tool => {
                        const totalScore = calculateTotalScore(tool);
                        const riskLevel = getRiskLevel(totalScore);
                        return includeRisks[riskLevel];
                    });
                }
                
                const detailLevel = document.querySelector('input[name="detailLevel"]:checked').value;
                
                if (exportFormat === 'pdf') {
                    generatePDFReport(toolsToExport, detailLevel);
                } else {
                    generateHTMLReport(toolsToExport, detailLevel);
                }
            }
            
            closeExportModal();
        }

        function exportJSON(toolsToExport) {
            const exportData = {
                exportDate: new Date().toISOString(),
                exportType: 'AI Risk Assessment Tools',
                toolCount: toolsToExport.length,
                tools: toolsToExport
            };
            
            const jsonString = JSON.stringify(exportData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AI_Risk_Assessment_Tools_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function generateHTMLReport(toolsToExport, detailLevel) {
            const reportHTML = `
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>AI Tool Risk Assessment Report</title>
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    
                    body { 
                        font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; 
                        line-height: 1.6; 
                        color: #2c3e50; 
                        background: #fafafa;
                        margin: 0;
                    }
                    
                    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
                    
                    .header { 
                        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); 
                        color: white; 
                        padding: 40px; 
                        margin: -20px -20px 40px -20px;
                        text-align: center;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    }
                    
                    .header h1 { 
                        font-size: 2.5em; 
                        font-weight: 300; 
                        margin-bottom: 10px; 
                    }
                    
                    .header .subtitle { 
                        font-size: 1.1em; 
                        opacity: 0.9; 
                        margin-bottom: 20px; 
                    }
                    
                    .header .meta { 
                        font-size: 0.95em; 
                        opacity: 0.8; 
                        border-top: 1px solid rgba(255,255,255,0.2); 
                        padding-top: 20px; 
                        margin-top: 20px; 
                    }
                    
                    .summary { 
                        background: white; 
                        padding: 30px; 
                        margin-bottom: 40px; 
                        border-radius: 8px; 
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        border-left: 6px solid #3498db; 
                    }
                    
                    .summary h2 { 
                        color: #2c3e50; 
                        margin-bottom: 20px; 
                        font-size: 1.8em; 
                        font-weight: 600; 
                    }
                    
                    .risk-stats { 
                        display: grid; 
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                        gap: 20px; 
                        margin: 20px 0; 
                    }
                    
                    .risk-stat { 
                        background: #f8f9fa; 
                        padding: 20px; 
                        border-radius: 6px; 
                        text-align: center; 
                        border-left: 4px solid;
                    }
                    
                    .risk-stat.critical { border-left-color: #d32f2f; }
                    .risk-stat.high { border-left-color: #ff9800; }
                    .risk-stat.medium { border-left-color: #ffc107; }
                    .risk-stat.low { border-left-color: #388e3c; }
                    
                    .risk-stat .number { 
                        font-size: 2.5em; 
                        font-weight: 700; 
                        color: #2c3e50; 
                        display: block; 
                    }
                    
                    .risk-stat .label { 
                        font-size: 0.9em; 
                        color: #666; 
                        text-transform: uppercase; 
                        letter-spacing: 0.5px; 
                    }
                    
                    .tool-section { 
                        background: white; 
                        margin-bottom: 30px; 
                        border-radius: 12px; 
                        overflow: hidden; 
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        page-break-inside: avoid; 
                        border-left: 6px solid;
                    }
                    
                    .tool-section.critical { border-left-color: #d32f2f; }
                    .tool-section.high { border-left-color: #ff9800; }
                    .tool-section.medium { border-left-color: #ffc107; }
                    .tool-section.low { border-left-color: #388e3c; }
                    
                    .tool-header { 
                        background: #f8f9fa; 
                        padding: 25px; 
                        border-bottom: 1px solid #e9ecef;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        flex-wrap: wrap;
                        gap: 15px;
                    }
                    
                    .tool-info h3 { 
                        font-size: 1.5em; 
                        font-weight: 600; 
                        color: #2c3e50; 
                        margin-bottom: 8px; 
                    }
                    
                    .tool-meta { 
                        font-size: 0.9em; 
                        color: #666; 
                    }
                    
                    .risk-badge { 
                        padding: 8px 16px; 
                        border-radius: 20px; 
                        font-weight: 600; 
                        font-size: 0.85em; 
                        text-transform: uppercase; 
                        letter-spacing: 0.5px; 
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    
                    .risk-badge.critical { background: #d32f2f; color: white; }
                    .risk-badge.high { background: #ff9800; color: white; }
                    .risk-badge.medium { background: #ffc107; color: #2c3e50; }
                    .risk-badge.low { background: #388e3c; color: white; }
                    
                    .score-overview { 
                        display: grid; 
                        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
                        gap: 15px; 
                        padding: 25px; 
                    }
                    
                    .score-card { 
                        background: #f8f9fa; 
                        padding: 20px; 
                        border-radius: 8px; 
                        text-align: center; 
                        border-left: 4px solid #666;
                    }
                    
                    .score-card .score { 
                        font-size: 1.8em; 
                        font-weight: 700; 
                        color: #2c3e50; 
                        display: block; 
                    }
                    
                    .score-card .max-score { 
                        font-size: 0.9em; 
                        color: #999; 
                    }
                    
                    .score-card .category { 
                        font-size: 0.85em; 
                        color: #666; 
                        margin-top: 8px; 
                        font-weight: 500; 
                    }
                    
                    .details { 
                        padding: 25px; 
                        background: #fdfdfd; 
                        border-top: 1px solid #e9ecef; 
                    }
                    
                    .details h4 { 
                        color: #2c3e50; 
                        margin-bottom: 15px; 
                        font-size: 1.2em; 
                        font-weight: 600; 
                    }
                    
                    .detail-grid { 
                        display: grid; 
                        gap: 20px; 
                    }
                    
                    .detail-item { 
                        background: white; 
                        padding: 20px; 
                        border-radius: 6px; 
                        border-left: 4px solid #3498db; 
                    }
                    
                    .detail-item h5 { 
                        color: #2c3e50; 
                        margin-bottom: 10px; 
                        font-size: 1em; 
                        font-weight: 600; 
                    }
                    
                    .detail-item p { 
                        color: #5d6d7e; 
                        font-size: 0.95em; 
                        line-height: 1.6; 
                    }
                    
                    .sub-scores { 
                        display: grid; 
                        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
                        gap: 15px; 
                        margin: 15px 0; 
                    }
                    
                    .sub-score { 
                        background: white; 
                        padding: 15px; 
                        border-radius: 6px; 
                        border-left: 3px solid #999; 
                        display: flex; 
                        justify-content: space-between; 
                        align-items: center; 
                    }
                    
                    .sub-score .label { 
                        font-weight: 600; 
                        color: #2c3e50; 
                    }
                    
                    .sub-score .score { 
                        font-weight: 700; 
                        color: #666; 
                    }
                    
                    .footer { 
                        text-align: center; 
                        padding: 40px 20px; 
                        color: #666; 
                        font-size: 0.9em; 
                        border-top: 1px solid #e9ecef; 
                        margin-top: 40px; 
                    }
                    
                    @media print { 
                        body { background: white; margin: 0; }
                        .container { max-width: none; padding: 0; }
                        .header { margin: 0 0 30px 0; }
                        .tool-section { break-inside: avoid; }
                        .score-overview { grid-template-columns: repeat(5, 1fr); }
                    }
                    
                    @media (max-width: 768px) {
                        .tool-header { flex-direction: column; align-items: flex-start; }
                        .score-overview { grid-template-columns: repeat(2, 1fr); }
                        .risk-stats { grid-template-columns: repeat(2, 1fr); }
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="header">
                        <h1>üîí AI Tool Risk Assessment Report</h1>
                        <div class="subtitle">Comprehensive Enterprise Risk Analysis & Compliance Assessment</div>
                        <div class="meta">
                            Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()} | 
                            ${toolsToExport.length} tools assessed | 
                            Report Level: ${detailLevel === 'pro' ? 'Professional (Full Details)' : 'Executive Summary'}
                        </div>
                    </div>
                    
                    <div class="summary">
                        <h2>üìä Executive Summary</h2>
                        <p style="font-size: 1.1em; color: #5d6d7e; margin-bottom: 25px;">
                            This assessment evaluates <strong>${toolsToExport.length} AI tools</strong> across five critical risk categories, 
                            providing actionable insights for enterprise security and compliance decisions.
                        </p>
                        
                        <div class="risk-stats">
                            <div class="risk-stat critical">
                                <span class="number">${toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'critical').length}</span>
                                <div class="label">üî¥ Critical Risk</div>
                            </div>
                            <div class="risk-stat high">
                                <span class="number">${toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'high').length}</span>
                                <div class="label">üü† High Risk</div>
                            </div>
                            <div class="risk-stat medium">
                                <span class="number">${toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'medium').length}</span>
                                <div class="label">üü° Medium Risk</div>
                            </div>
                            <div class="risk-stat low">
                                <span class="number">${toolsToExport.filter(t => getRiskLevel(calculateTotalScore(t)) === 'low').length}</span>
                                <div class="label">üü¢ Low Risk</div>
                            </div>
                        </div>
                        
                        <p style="font-size: 0.95em; color: #666; margin-top: 20px;">
                            <strong>Risk Scoring:</strong> Critical (80-100) | High (60-79) | Medium (35-59) | Low (0-34)
                        </p>
                    </div>
                
                ${toolsToExport.map((tool, index) => {
                    const totalScore = calculateTotalScore(tool);
                    const riskLevel = getRiskLevel(totalScore);
                    const riskEmoji = getRiskEmoji(riskLevel);
                    
                    const riskSummaryHTML = `
                        <div class="details">
                            <h4>üìã Risk Summary</h4>
                            <p style="font-size: 1.05em; line-height: 1.7;">
                                <strong>${tool.name}</strong> presents <strong style="color: ${
                                    riskLevel === 'critical' ? '#d32f2f' : 
                                    riskLevel === 'high' ? '#ff9800' :
                                    riskLevel === 'medium' ? '#f57c00' : '#388e3c'
                                };">${riskLevel} risk</strong> with a total score of <strong>${totalScore}/100</strong>.
                            </p>
                            <p style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid ${
                                riskLevel === 'critical' ? '#d32f2f' : 
                                riskLevel === 'high' ? '#ff9800' :
                                riskLevel === 'medium' ? '#f57c00' : '#388e3c'
                            };">
                                <strong>Recommendation:</strong> 
                                ${tool.recommendation || (riskLevel === 'critical' ? 'üö® Immediate action required to address critical security concerns before deployment.' : 
                                  riskLevel === 'high' ? '‚ö†Ô∏è Significant security improvements needed before enterprise deployment.' :
                                  riskLevel === 'medium' ? '‚ö° Moderate risk - implement additional security measures and monitoring.' : 
                                  '‚úÖ Low risk - suitable for general enterprise use with standard security precautions.')}
                            </p>
                        </div>
                    `;

                    const proReportDetailsHTML = `
                        <div class="details">
                            <h4>üîç Detailed Risk Assessment</h4>
                            <div class="detail-grid">
                                                                                                                <div class="detail-item">
                                            <h5>üîê Data Storage & Security</h5>
                                            ${tool.subScores?.dataStorage ? `
                                                <div style="margin: 10px 0;">
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Geographic:</strong> ${tool.subScores.dataStorage.geographic.note}
                                                    </div>
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Encryption:</strong> ${tool.subScores.dataStorage.encryption.note}
                                                    </div>
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Retention:</strong> ${tool.subScores.dataStorage.retention.note}
                                                    </div>
                                                </div>
                                            ` : `<p>${tool.details.dataStorage}</p>`}
                                        </div>
                                        
                                        <div class="detail-item">
                                            <h5>ü§ñ Training Data Usage</h5>
                                            ${tool.subScores?.trainingUsage ? `
                                                <div style="margin: 10px 0;">
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Training:</strong> ${tool.subScores.trainingUsage.training.note}
                                                    </div>
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Sharing:</strong> ${tool.subScores.trainingUsage.sharing.note}
                                                    </div>
                                                </div>
                                            ` : `<p>${tool.details.trainingUsage}</p>`}
                                        </div>
                                        
                                        <div class="detail-item">
                                            <h5>üë• Access Controls</h5>
                                            ${tool.subScores?.accessControls ? `
                                                <div style="margin: 10px 0;">
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Admin:</strong> ${tool.subScores.accessControls.admin.note}
                                                    </div>
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Audit:</strong> ${tool.subScores.accessControls.audit.note}
                                                    </div>
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Integration:</strong> ${tool.subScores.accessControls.integration.note}
                                                    </div>
                                                </div>
                                            ` : `<p>${tool.details.accessControls}</p>`}
                                        </div>
                                        
                                        <div class="detail-item">
                                            <h5>‚öñÔ∏è Compliance & Legal Risk</h5>
                                            ${tool.subScores?.complianceRisk ? `
                                                <div style="margin: 10px 0;">
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Violations:</strong> ${tool.subScores.complianceRisk.violations.note}
                                                    </div>
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Transparency:</strong> ${tool.subScores.complianceRisk.transparency.note}
                                                    </div>
                                                </div>
                                            ` : `<p>${tool.details.complianceRisk}</p>`}
                                        </div>
                                        
                                        <div class="detail-item">
                                            <h5>üîç Vendor Transparency</h5>
                                            ${tool.subScores?.vendorTransparency ? `
                                                <div style="margin: 10px 0;">
                                                    <div style="background: #f8f9fa; padding: 8px 12px; margin: 4px 0; border-radius: 4px; border-left: 3px solid #999; font-size: 0.9em;">
                                                        <strong>Overall:</strong> ${tool.subScores.vendorTransparency.score.note}
                                                    </div>
                                                </div>
                                            ` : `<p>${tool.details.vendorTransparency}</p>`}
                                        </div>
                            </div>
                        </div>
                    `;

                    return `
                    <div class="tool-section ${riskLevel}">
                        <div class="tool-header">
                            <div class="tool-info">
                                <h3>${tool.name}</h3>
                                <div class="tool-meta">
                                    <strong>Category:</strong> ${tool.category} | 
                                    <strong>Last Updated:</strong> ${tool.lastUpdated}
                                </div>
                                ${tool.compliance ? `
                                    <div style="margin-top: 10px;">
                                        <strong>Regulatory Compliance:</strong>
                                        <div style="display: flex; gap: 8px; margin-top: 5px; flex-wrap: wrap;">
                                            ${tool.compliance.hipaa ? `<span style="padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; ${tool.compliance.hipaa === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.hipaa === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                ${tool.compliance.hipaa === 'compliant' ? '‚úÖ HIPAA' : tool.compliance.hipaa === 'partial-compliant' ? '‚ö†Ô∏è HIPAA*' : '‚ùå HIPAA'}
                                            </span>` : ''}
                                            ${tool.compliance.gdpr ? `<span style="padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; ${tool.compliance.gdpr === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.gdpr === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                ${tool.compliance.gdpr === 'compliant' ? '‚úÖ GDPR' : tool.compliance.gdpr === 'partial-compliant' ? '‚ö†Ô∏è GDPR*' : '‚ùå GDPR'}
                                            </span>` : ''}
                                            ${tool.compliance.sox ? `<span style="padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; ${tool.compliance.sox === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.sox === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                ${tool.compliance.sox === 'compliant' ? '‚úÖ SOX' : tool.compliance.sox === 'partial-compliant' ? '‚ö†Ô∏è SOX*' : '‚ùå SOX'}
                                            </span>` : ''}
                                            ${tool.compliance.pci ? `<span style="padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: 600; ${tool.compliance.pci === 'compliant' ? 'background: #e8f5e8; color: #2e7d32;' : tool.compliance.pci === 'partial-compliant' ? 'background: #fff8e1; color: #f57c00;' : 'background: #ffebee; color: #c62828;'}">
                                                ${tool.compliance.pci === 'compliant' ? '‚úÖ PCI-DSS' : tool.compliance.pci === 'partial-compliant' ? '‚ö†Ô∏è PCI-DSS*' : '‚ùå PCI-DSS'}
                                            </span>` : ''}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="risk-badge ${riskLevel}">
                                ${riskEmoji} ${totalScore}/100 ${riskLevel.toUpperCase()}
                            </div>
                        </div>
                        
                        <div class="score-overview">
                            <div class="score-card">
                                <span class="score">${tool.dataStorage}<span class="max-score">/25</span></span>
                                <div class="category">üîê Data Storage & Security</div>
                            </div>
                            <div class="score-card">
                                <span class="score">${tool.trainingUsage}<span class="max-score">/25</span></span>
                                <div class="category">ü§ñ Training Data Usage</div>
                            </div>
                            <div class="score-card">
                                <span class="score">${tool.accessControls}<span class="max-score">/20</span></span>
                                <div class="category">üë• Access Controls</div>
                            </div>
                            <div class="score-card">
                                <span class="score">${tool.complianceRisk}<span class="max-score">/20</span></span>
                                <div class="category">‚öñÔ∏è Compliance & Legal</div>
                            </div>
                            <div class="score-card">
                                <span class="score">${tool.vendorTransparency}<span class="max-score">/10</span></span>
                                <div class="category">üîç Vendor Transparency</div>
                            </div>
                        </div>
                        
                        ${detailLevel === 'pro' ? proReportDetailsHTML + riskSummaryHTML : riskSummaryHTML}
                    </div>
                    `;
                }).join('')}
                
                <div class="footer">
                    <p><strong>AI Tool Risk Assessment Framework</strong></p>
                    <p>Generated by Enterprise Risk Management System | Confidential & Proprietary</p>
                    <p>For questions about this assessment, please contact your IT Security team</p>
                </div>
                
                </div>
            </body>
            </html>
            `;
            
            const blob = new Blob([reportHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AI_Risk_Assessment_Report_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Event listeners
        document.getElementById('riskFilter').addEventListener('change', filterTools);
        document.getElementById('categoryFilter').addEventListener('change', filterTools);
        document.getElementById('searchInput').addEventListener('input', filterTools);

        // Modal click outside to close
        document.getElementById('exportModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExportModal();
            }
        });

        // Initialize the dashboard
        renderTools();

        function toggleScoreEditorCategory(button) {
            const content = button.nextElementSibling;
            content.classList.toggle('show');
        }
        
        function updateFormTotals() {
            // Data Storage
            const ds_geo = parseInt(document.getElementById('form_dataStorage_geographic_score').value) || 0;
            const ds_enc = parseInt(document.getElementById('form_dataStorage_encryption_score').value) || 0;
            const ds_ret = parseInt(document.getElementById('form_dataStorage_retention_score').value) || 0;
            document.getElementById('form_dataStorage_total').textContent = `${ds_geo + ds_enc + ds_ret}/25`;

            // Training Usage
            const tu_tra = parseInt(document.getElementById('form_trainingUsage_training_score').value) || 0;
            const tu_sha = parseInt(document.getElementById('form_trainingUsage_sharing_score').value) || 0;
            document.getElementById('form_trainingUsage_total').textContent = `${tu_tra + tu_sha}/25`;

            // Access Controls
            const ac_adm = parseInt(document.getElementById('form_accessControls_admin_score').value) || 0;
            const ac_aud = parseInt(document.getElementById('form_accessControls_audit_score').value) || 0;
            const ac_int = parseInt(document.getElementById('form_accessControls_integration_score').value) || 0;
            document.getElementById('form_accessControls_total').textContent = `${ac_adm + ac_aud + ac_int}/20`;
            
            // Compliance Risk
            const cr_vio = parseInt(document.getElementById('form_complianceRisk_violations_score').value) || 0;
            const cr_tra = parseInt(document.getElementById('form_complianceRisk_transparency_score').value) || 0;
            document.getElementById('form_complianceRisk_total').textContent = `${cr_vio + cr_tra}/20`;

            // Vendor Transparency
            const vt_sco = parseInt(document.getElementById('form_vendorTransparency_score_score').value) || 0;
            document.getElementById('form_vendorTransparency_total').textContent = `${vt_sco}/10`;
        }
    </script>
</body>
</html>